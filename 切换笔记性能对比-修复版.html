<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ‡æ¢ç¬”è®°æ€§èƒ½å¯¹æ¯” - ä¿®å¤ç‰ˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .demo-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #555;
        }
        
        .performance-test {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .test-button.original {
            background: #ff6b6b;
            color: white;
        }
        
        .test-button.optimized {
            background: #51cf66;
            color: white;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .test-button:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .result.original {
            background: #ffe6e6;
            border-left: 4px solid #ff6b6b;
        }
        
        .result.optimized {
            background: #e6ffe6;
            border-left: 4px solid #51cf66;
        }
        
        .notes-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .notes-list {
            width: 300px;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow-y: auto;
            background: white;
        }
        
        .note-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .note-item:hover {
            background: #f8f9fa;
        }
        
        .note-item.active {
            background: #007bff;
            color: white;
        }
        
        .note-content {
            flex: 1;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 20px;
            background: white;
            overflow-y: auto;
        }
        
        .explanation {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
        }
        
        .explanation h4 {
            margin-top: 0;
            color: #007bff;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-item {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .debug-info {
            background: #fff3cd;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 12px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ åˆ‡æ¢ç¬”è®°æ€§èƒ½å¯¹æ¯”æ¼”ç¤º - ä¿®å¤ç‰ˆ</h1>
        
        <div class="explanation">
            <h4>ğŸ’¡ ä¿®å¤è¯´æ˜</h4>
            <p>è¿™ä¸ªç‰ˆæœ¬ä¿®å¤äº†æŒ‰é’®ç‚¹å‡»é—®é¢˜ï¼Œç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼</p>
        </div>
        
        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div class="debug-info" id="debug-info">
            é¡µé¢åŠ è½½ä¸­... è¯·ç­‰å¾…åˆå§‹åŒ–å®Œæˆ
        </div>
        
        <!-- æ€§èƒ½æµ‹è¯• -->
        <div class="demo-section">
            <div class="demo-title">âš¡ æ€§èƒ½æµ‹è¯•</div>
            <p>æ¨¡æ‹Ÿåˆ‡æ¢ç¬”è®°100æ¬¡ï¼Œçœ‹çœ‹ä¼˜åŒ–å‰åçš„å·®å¼‚ï¼š</p>
            
            <div class="performance-test">
                <button class="test-button original" id="original-btn">
                    ğŸŒ åŸå§‹åˆ‡æ¢æ–¹å¼
                </button>
                <button class="test-button optimized" id="optimized-btn">
                    ğŸš€ ä¼˜åŒ–åˆ‡æ¢æ–¹å¼
                </button>
            </div>
            
            <div id="switch-result">
                <div class="result">
                    ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®å¼€å§‹æµ‹è¯•...
                </div>
            </div>
        </div>
        
        <!-- å®æ—¶æ¼”ç¤º -->
        <div class="demo-section">
            <div class="demo-title">ğŸ¯ å®æ—¶æ¼”ç¤º</div>
            <p>ç‚¹å‡»å·¦ä¾§ç¬”è®°åˆ—è¡¨ï¼Œä½“éªŒåˆ‡æ¢ç¬”è®°çš„æ€§èƒ½ï¼š</p>
            
            <div class="notes-container">
                <div class="notes-list" id="notes-list">
                    <!-- ç¬”è®°åˆ—è¡¨ä¼šåœ¨è¿™é‡Œç”Ÿæˆ -->
                </div>
                <div class="note-content" id="note-content">
                    <h3>é€‰æ‹©å·¦ä¾§çš„ç¬”è®°å¼€å§‹ä½“éªŒ</h3>
                    <p>ç‚¹å‡»ä¸åŒçš„ç¬”è®°ï¼Œè§‚å¯Ÿåˆ‡æ¢çš„æµç•…åº¦...</p>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="switch-count">0</div>
                    <div class="stat-label">åˆ‡æ¢æ¬¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="avg-time">0ms</div>
                    <div class="stat-label">å¹³å‡åˆ‡æ¢æ—¶é—´</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="dom-ops">0</div>
                    <div class="stat-label">DOMæ“ä½œæ¬¡æ•°</div>
                </div>
            </div>
        </div>
        
        <!-- åŸç†è§£é‡Š -->
        <div class="demo-section">
            <div class="demo-title">ğŸ” ä¼˜åŒ–åŸç†è§£é‡Š</div>
            
            <div class="explanation">
                <h4>åŸå§‹æ–¹å¼çš„é—®é¢˜</h4>
                <p><strong>æ¯æ¬¡åˆ‡æ¢ç¬”è®°æ—¶ï¼š</strong></p>
                <ul>
                    <li>æ¸…ç©ºæ•´ä¸ªç¬”è®°åˆ—è¡¨</li>
                    <li>é‡æ–°åˆ›å»ºæ‰€æœ‰ç¬”è®°çš„DOMå…ƒç´ </li>
                    <li>é‡æ–°ç»‘å®šæ‰€æœ‰ç‚¹å‡»äº‹ä»¶</li>
                    <li>é‡æ–°è®¾ç½®æ‰€æœ‰æ ·å¼</li>
                </ul>
                <p><strong>ç»“æœï¼š</strong> 100ç¯‡ç¬”è®° = 100æ¬¡DOMæ“ä½œ</p>
            </div>
            
            <div class="explanation">
                <h4>ä¼˜åŒ–åçš„æ–¹å¼</h4>
                <p><strong>æ¯æ¬¡åˆ‡æ¢ç¬”è®°æ—¶ï¼š</strong></p>
                <ul>
                    <li>åªæ›´æ–°å½“å‰ç¬”è®°çš„activeçŠ¶æ€</li>
                    <li>åªæ›´æ–°ç¬”è®°å†…å®¹åŒºåŸŸ</li>
                    <li>ä¿æŒå…¶ä»–ç¬”è®°çš„DOMä¸å˜</li>
                    <li>åªæ“ä½œ2-3ä¸ªDOMå…ƒç´ </li>
                </ul>
                <p><strong>ç»“æœï¼š</strong> 100ç¯‡ç¬”è®° = 2-3æ¬¡DOMæ“ä½œ</p>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç¬”è®°æ•°æ®
        const notesData = Array.from({length: 100}, (_, i) => ({
            id: i,
            title: `ç¬”è®° ${i + 1}`,
            content: `è¿™æ˜¯ç¬¬ ${i + 1} ä¸ªç¬”è®°çš„å†…å®¹ã€‚\n\nè¿™é‡Œæœ‰å¾ˆå¤šå†…å®¹...\n\nåŒ…æ‹¬ï¼š\n- åˆ—è¡¨é¡¹1\n- åˆ—è¡¨é¡¹2\n- åˆ—è¡¨é¡¹3\n\nè¿˜æœ‰æ›´å¤šçš„æ–‡æœ¬å†…å®¹ï¼Œç”¨æ¥æ¨¡æ‹ŸçœŸå®çš„ç¬”è®°é•¿åº¦ã€‚`
        }));

        let currentNoteId = 0;
        let switchCount = 0;
        let totalTime = 0;
        let totalDomOps = 0;

        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        function updateDebugInfo(message) {
            const debugEl = document.getElementById('debug-info');
            debugEl.textContent = message;
            console.log(message);
        }

        // åˆå§‹åŒ–ç¬”è®°åˆ—è¡¨
        function initNotesList() {
            updateDebugInfo('æ­£åœ¨åˆå§‹åŒ–ç¬”è®°åˆ—è¡¨...');
            
            const listContainer = document.getElementById('notes-list');
            listContainer.innerHTML = '';
            
            notesData.forEach(note => {
                const item = document.createElement('div');
                item.className = 'note-item';
                item.dataset.noteId = note.id;
                item.innerHTML = `
                    <strong>${note.title}</strong><br>
                    <small style="color: #666;">ç‚¹å‡»åˆ‡æ¢åˆ°æ­¤ç¬”è®°</small>
                `;
                
                item.addEventListener('click', () => {
                    switchToNote(note.id);
                });
                
                listContainer.appendChild(item);
            });
            
            // è®¾ç½®ç¬¬ä¸€ä¸ªç¬”è®°ä¸ºactive
            switchToNote(0);
            updateDebugInfo('ç¬”è®°åˆ—è¡¨åˆå§‹åŒ–å®Œæˆï¼å¯ä»¥ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ€§èƒ½äº†ã€‚');
        }

        // åŸå§‹åˆ‡æ¢æ–¹å¼ï¼ˆæ¨¡æ‹Ÿé‡æ–°æ¸²æŸ“æ•´ä¸ªåˆ—è¡¨ï¼‰
        function testOriginalSwitch() {
            updateDebugInfo('å¼€å§‹æµ‹è¯•åŸå§‹åˆ‡æ¢æ–¹å¼...');
            
            const startTime = performance.now();
            let domOps = 0;
            
            // æ¨¡æ‹Ÿ100æ¬¡åˆ‡æ¢
            for (let i = 0; i < 100; i++) {
                const noteId = i % notesData.length;
                
                // æ¨¡æ‹Ÿé‡æ–°æ¸²æŸ“æ•´ä¸ªåˆ—è¡¨
                const listContainer = document.getElementById('notes-list');
                listContainer.innerHTML = '';
                
                notesData.forEach(note => {
                    const item = document.createElement('div');
                    item.className = 'note-item';
                    item.dataset.noteId = note.id;
                    item.innerHTML = `
                        <strong>${note.title}</strong><br>
                        <small style="color: #666;">ç‚¹å‡»åˆ‡æ¢åˆ°æ­¤ç¬”è®°</small>
                    `;
                    listContainer.appendChild(item);
                    domOps++;
                });
                
                // è®¾ç½®activeçŠ¶æ€
                const activeItem = listContainer.querySelector(`[data-note-id="${noteId}"]`);
                if (activeItem) {
                    activeItem.classList.add('active');
                }
                
                // æ›´æ–°å†…å®¹
                const contentContainer = document.getElementById('note-content');
                contentContainer.innerHTML = `<h3>${notesData[noteId].title}</h3><p>${notesData[noteId].content}</p>`;
            }
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('switch-result').innerHTML = `
                <div class="result original">
                    <strong>åŸå§‹åˆ‡æ¢æ–¹å¼ç»“æœï¼š</strong><br>
                    åˆ‡æ¢äº† 100 æ¬¡ç¬”è®°<br>
                    è€—æ—¶ï¼š${duration.toFixed(2)}ms<br>
                    DOMæ“ä½œæ¬¡æ•°ï¼š${domOps} æ¬¡<br>
                    å¹³å‡æ¯æ¬¡åˆ‡æ¢ï¼š${(duration / 100).toFixed(2)}ms
                </div>
            `;
            
            updateDebugInfo(`åŸå§‹åˆ‡æ¢æ–¹å¼æµ‹è¯•å®Œæˆï¼è€—æ—¶ï¼š${duration.toFixed(2)}ms`);
        }

        // ä¼˜åŒ–åˆ‡æ¢æ–¹å¼ï¼ˆåªæ›´æ–°å¿…è¦çš„éƒ¨åˆ†ï¼‰
        function testOptimizedSwitch() {
            updateDebugInfo('å¼€å§‹æµ‹è¯•ä¼˜åŒ–åˆ‡æ¢æ–¹å¼...');
            
            const startTime = performance.now();
            let domOps = 0;
            
            // æ¨¡æ‹Ÿ100æ¬¡åˆ‡æ¢
            for (let i = 0; i < 100; i++) {
                const noteId = i % notesData.length;
                
                // åªæ›´æ–°activeçŠ¶æ€
                const allItems = document.querySelectorAll('.note-item');
                allItems.forEach(item => {
                    item.classList.remove('active');
                    domOps++;
                });
                
                const activeItem = document.querySelector(`[data-note-id="${noteId}"]`);
                if (activeItem) {
                    activeItem.classList.add('active');
                    domOps++;
                }
                
                // åªæ›´æ–°å†…å®¹
                const contentContainer = document.getElementById('note-content');
                contentContainer.innerHTML = `<h3>${notesData[noteId].title}</h3><p>${notesData[noteId].content}</p>`;
                domOps++;
            }
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('switch-result').innerHTML = `
                <div class="result optimized">
                    <strong>ä¼˜åŒ–åˆ‡æ¢æ–¹å¼ç»“æœï¼š</strong><br>
                    åˆ‡æ¢äº† 100 æ¬¡ç¬”è®°<br>
                    è€—æ—¶ï¼š${duration.toFixed(2)}ms<br>
                    DOMæ“ä½œæ¬¡æ•°ï¼š${domOps} æ¬¡<br>
                    å¹³å‡æ¯æ¬¡åˆ‡æ¢ï¼š${(duration / 100).toFixed(2)}ms<br>
                    <em>æ€§èƒ½æå‡ï¼š${((500 / duration) * 100).toFixed(0)}%</em>
                </div>
            `;
            
            updateDebugInfo(`ä¼˜åŒ–åˆ‡æ¢æ–¹å¼æµ‹è¯•å®Œæˆï¼è€—æ—¶ï¼š${duration.toFixed(2)}ms`);
        }

        // å®æ—¶åˆ‡æ¢ç¬”è®°
        function switchToNote(noteId) {
            const startTime = performance.now();
            
            // æ›´æ–°activeçŠ¶æ€
            const allItems = document.querySelectorAll('.note-item');
            allItems.forEach(item => item.classList.remove('active'));
            
            const activeItem = document.querySelector(`[data-note-id="${noteId}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // æ›´æ–°å†…å®¹
            const contentContainer = document.getElementById('note-content');
            contentContainer.innerHTML = `
                <h3>${notesData[noteId].title}</h3>
                <p>${notesData[noteId].content}</p>
            `;
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            // æ›´æ–°ç»Ÿè®¡
            switchCount++;
            totalTime += duration;
            totalDomOps += 3; // ç§»é™¤active + æ·»åŠ active + æ›´æ–°å†…å®¹
            
            document.getElementById('switch-count').textContent = switchCount;
            document.getElementById('avg-time').textContent = (totalTime / switchCount).toFixed(1) + 'ms';
            document.getElementById('dom-ops').textContent = totalDomOps;
            
            currentNoteId = noteId;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            updateDebugInfo('é¡µé¢åŠ è½½å®Œæˆï¼Œæ­£åœ¨åˆå§‹åŒ–...');
            
            // åˆå§‹åŒ–ç¬”è®°åˆ—è¡¨
            initNotesList();
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('original-btn').addEventListener('click', function() {
                console.log('åŸå§‹åˆ‡æ¢æŒ‰é’®è¢«ç‚¹å‡»');
                testOriginalSwitch();
            });
            
            document.getElementById('optimized-btn').addEventListener('click', function() {
                console.log('ä¼˜åŒ–åˆ‡æ¢æŒ‰é’®è¢«ç‚¹å‡»');
                testOptimizedSwitch();
            });
            
            updateDebugInfo('åˆå§‹åŒ–å®Œæˆï¼æŒ‰é’®å·²ç»‘å®šï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•äº†ã€‚');
        };
    </script>
</body>
</html>

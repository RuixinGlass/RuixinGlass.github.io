# 事件驱动架构说明

## 架构概述

本应用采用事件驱动架构，实现模块间的松耦合通信。所有模块通过自定义事件进行通信，避免直接依赖。

## 事件分类

### 1. 业务逻辑事件（由业务模块触发）

| 事件名称 | 触发模块 | 监听模块 | 事件数据 | 说明 |
|----------|----------|----------|----------|------|
| `loadNote` | `main.js` | `events.js` | `{ noteId: string }` | 加载指定笔记 |
| `sceneChanged` | `note.js` | `events.js` | `{ scene: 'welcome' \| 'note' }` | 场景切换 |
| `noteSwitched` | `note.js` | `events.js` | `{ noteId: string }` | 笔记切换完成 |
| `editModeEntered` | `note.js` | `events.js` | 无 | 进入编辑模式 |
| `previewModeEntered` | `note.js` | `events.js` | 无 | 进入预览模式 |
| `previewContentUpdate` | `note.js` | `events.js` | `{ content: string }` | 预览内容更新 |
| `wordCountUpdate` | `note.js` | `events.js` | 无 | 字数统计更新 |
| `sidebarCollapse` | `note.js` | `events.js` | 无 | 侧边栏收起 |
| `versionSaved` | `version.js` | `events.js` | `{ noteId: string }` | 版本保存成功 |
| `showVersionDiff` | `version.js` | `events.js` | `{ currentContent, previousContent, versionIndex }` | 显示版本差异 |
| `uiInitialized` | `ui.js` | `events.js` | 无 | UI初始化完成 |

### 2. DOM事件（由用户交互触发）

| 事件类型 | 触发元素 | 处理模块 | 说明 |
|----------|----------|----------|------|
| `click` | 各种按钮 | `events.js` | 用户点击操作 |
| `input` | 输入框 | `events.js` | 用户输入操作 |
| `touchstart/touchmove/touchend` | 移动端手势 | `events.js` | 移动端侧边栏手势 |
| `keydown` | 键盘快捷键 | `events.js` | 键盘快捷键操作 |

## 事件流示例

### 笔记切换流程

```
用户点击笔记 → DOM事件 → events.js → 调用switchNote() → note.js → 触发noteSwitched事件 → events.js → 调用renderNotesList() → ui.js
```

### 编辑模式切换流程

```
用户点击编辑按钮 → DOM事件 → events.js → 调用enterEditMode() → note.js → 触发editModeEntered事件 → events.js → 调用updateEditButton() → ui.js
```

### 版本保存流程

```
用户点击保存 → DOM事件 → events.js → 调用saveVersion() → version.js → 触发versionSaved事件 → events.js → 调用renderNotesList() → ui.js
```

## 架构优势

1. **松耦合**：模块间不直接依赖，通过事件通信
2. **可扩展**：新增功能只需添加事件监听器
3. **可测试**：每个模块可以独立测试
4. **可维护**：事件流清晰，易于调试和维护

## 模块职责

- **`main.js`**：应用初始化，业务决策
- **`note.js`**：笔记业务逻辑，触发业务事件
- **`version.js`**：版本控制逻辑，触发版本事件
- **`ui.js`**：UI渲染，纯UI操作
- **`events.js`**：事件监听和处理，模块协调
- **`state.js`**：状态管理
- **`dom.js`**：DOM元素管理
- **`utils.js`**：工具函数

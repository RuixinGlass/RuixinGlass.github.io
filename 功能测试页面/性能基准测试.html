<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性能基准测试 - 简·记</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a9e;
        }
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
        }
        .progress {
            background: #e9ecef;
            border-radius: 4px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-bar {
            background: #007acc;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>🚀 性能基准测试</h1>
    
    <div class="warning">
        <strong>⚠️ 注意：</strong> 此测试会创建大量测试数据，建议在测试前备份您的真实数据。
    </div>

    <div class="test-container">
        <h2>📊 基础性能测试</h2>
        <button class="test-button" onclick="testStartupTime()">测试启动时间</button>
        <button class="test-button" onclick="testSaveTime()">测试保存时间</button>
        <button class="test-button" onclick="testSwitchTime()">测试切换时间</button>
        <button class="test-button" onclick="testMemoryUsage()">测试内存占用</button>
        <div id="basicResults" class="result"></div>
    </div>

    <div class="test-container">
        <h2>📈 压力测试</h2>
        <button class="test-button" onclick="createTestData()">创建测试数据</button>
        <button class="test-button" onclick="testLargeDataset()">大数据量测试</button>
        <button class="test-button" onclick="testStoragePerformance()">存储性能测试</button>
        <div id="stressResults" class="result"></div>
        <div class="progress">
            <div id="progressBar" class="progress-bar"></div>
        </div>
    </div>

    <div class="test-container">
        <h2>🧹 清理测试数据</h2>
        <button class="test-button" onclick="cleanupTestData()">清理所有测试数据</button>
        <div id="cleanupResults" class="result"></div>
    </div>

    <script>
        // 模拟您的应用数据结构
        let testNotesData = {
            currentNoteId: null,
            notes: {}
        };

        // 基础性能测试
        async function testStartupTime() {
            const startTime = performance.now();
            
            // 模拟启动过程
            await new Promise(resolve => setTimeout(resolve, 100)); // 模拟数据加载
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('basicResults').innerHTML += `
                <div>✅ 启动时间测试: ${duration.toFixed(2)}ms</div>
            `;
        }

        async function testSaveTime() {
            const testNote = {
                id: 'test_note',
                title: '测试笔记',
                content: '这是一个测试笔记的内容'.repeat(100), // 约2KB内容
                lastModified: new Date().toISOString(),
                versions: []
            };

            const startTime = performance.now();
            
            // 模拟保存过程
            testNotesData.notes[testNote.id] = testNote;
            await new Promise(resolve => setTimeout(resolve, 50)); // 模拟存储延迟
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('basicResults').innerHTML += `
                <div>✅ 保存时间测试: ${duration.toFixed(2)}ms</div>
            `;
        }

        async function testSwitchTime() {
            const startTime = performance.now();
            
            // 模拟笔记切换
            await new Promise(resolve => setTimeout(resolve, 30)); // 模拟切换延迟
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('basicResults').innerHTML += `
                <div>✅ 切换时间测试: ${duration.toFixed(2)}ms</div>
            `;
        }

        function testMemoryUsage() {
            if (performance.memory) {
                const memory = performance.memory;
                const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                const totalMB = (memory.totalJSHeapSize / 1024 / 1024).toFixed(2);
                
                document.getElementById('basicResults').innerHTML += `
                    <div>✅ 内存占用: ${usedMB}MB / ${totalMB}MB</div>
                `;
            } else {
                document.getElementById('basicResults').innerHTML += `
                    <div>⚠️ 无法获取内存信息（浏览器不支持）</div>
                `;
            }
        }

        // 压力测试
        async function createTestData() {
            const noteCount = 100;
            const progressBar = document.getElementById('progressBar');
            
            for (let i = 0; i < noteCount; i++) {
                const testNote = {
                    id: `test_note_${i}`,
                    title: `测试笔记 ${i}`,
                    content: `这是第 ${i} 个测试笔记的内容。`.repeat(50), // 约1KB内容
                    lastModified: new Date().toISOString(),
                    versions: []
                };
                
                testNotesData.notes[testNote.id] = testNote;
                
                // 更新进度条
                const progress = ((i + 1) / noteCount) * 100;
                progressBar.style.width = progress + '%';
                
                // 每10个笔记暂停一下，避免阻塞UI
                if (i % 10 === 0) {
                    await new Promise(resolve => setTimeout(resolve, 10));
                }
            }
            
            document.getElementById('stressResults').innerHTML += `
                <div>✅ 创建了 ${noteCount} 个测试笔记</div>
            `;
        }

        async function testLargeDataset() {
            const startTime = performance.now();
            
            // 模拟大数据量操作
            const noteIds = Object.keys(testNotesData.notes);
            let totalContentLength = 0;
            
            for (const noteId of noteIds) {
                totalContentLength += testNotesData.notes[noteId].content.length;
            }
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('stressResults').innerHTML += `
                <div>✅ 大数据量测试: ${duration.toFixed(2)}ms (总内容: ${(totalContentLength / 1024).toFixed(2)}KB)</div>
            `;
        }

        async function testStoragePerformance() {
            const startTime = performance.now();
            
            // 模拟存储操作
            const dataSize = JSON.stringify(testNotesData).length;
            await new Promise(resolve => setTimeout(resolve, dataSize / 1000)); // 模拟基于数据大小的延迟
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('stressResults').innerHTML += `
                <div>✅ 存储性能测试: ${duration.toFixed(2)}ms (数据大小: ${(dataSize / 1024).toFixed(2)}KB)</div>
            `;
        }

        function cleanupTestData() {
            testNotesData = {
                currentNoteId: null,
                notes: {}
            };
            
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('cleanupResults').innerHTML = `
                <div>✅ 测试数据清理完成</div>
            `;
        }

        // 页面加载时显示当前数据状态
        window.addEventListener('load', () => {
            document.getElementById('basicResults').innerHTML = `
                <div>📊 当前测试数据状态: ${Object.keys(testNotesData.notes).length} 个笔记</div>
            `;
        });
    </script>
</body>
</html>

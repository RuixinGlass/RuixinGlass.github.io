<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§èƒ½åŸºå‡†æµ‹è¯• - ç®€Â·è®°</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a9e;
        }
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
        }
        .progress {
            background: #e9ecef;
            border-radius: 4px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-bar {
            background: #007acc;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ æ€§èƒ½åŸºå‡†æµ‹è¯•</h1>
    
    <div class="warning">
        <strong>âš ï¸ æ³¨æ„ï¼š</strong> æ­¤æµ‹è¯•ä¼šåˆ›å»ºå¤§é‡æµ‹è¯•æ•°æ®ï¼Œå»ºè®®åœ¨æµ‹è¯•å‰å¤‡ä»½æ‚¨çš„çœŸå®æ•°æ®ã€‚
    </div>

    <div class="test-container">
        <h2>ğŸ“Š åŸºç¡€æ€§èƒ½æµ‹è¯•</h2>
        <button class="test-button" onclick="testStartupTime()">æµ‹è¯•å¯åŠ¨æ—¶é—´</button>
        <button class="test-button" onclick="testSaveTime()">æµ‹è¯•ä¿å­˜æ—¶é—´</button>
        <button class="test-button" onclick="testSwitchTime()">æµ‹è¯•åˆ‡æ¢æ—¶é—´</button>
        <button class="test-button" onclick="testMemoryUsage()">æµ‹è¯•å†…å­˜å ç”¨</button>
        <div id="basicResults" class="result"></div>
    </div>

    <div class="test-container">
        <h2>ğŸ“ˆ å‹åŠ›æµ‹è¯•</h2>
        <button class="test-button" onclick="createTestData()">åˆ›å»ºæµ‹è¯•æ•°æ®</button>
        <button class="test-button" onclick="testLargeDataset()">å¤§æ•°æ®é‡æµ‹è¯•</button>
        <button class="test-button" onclick="testStoragePerformance()">å­˜å‚¨æ€§èƒ½æµ‹è¯•</button>
        <div id="stressResults" class="result"></div>
        <div class="progress">
            <div id="progressBar" class="progress-bar"></div>
        </div>
    </div>

    <div class="test-container">
        <h2>ğŸ§¹ æ¸…ç†æµ‹è¯•æ•°æ®</h2>
        <button class="test-button" onclick="cleanupTestData()">æ¸…ç†æ‰€æœ‰æµ‹è¯•æ•°æ®</button>
        <div id="cleanupResults" class="result"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ‚¨çš„åº”ç”¨æ•°æ®ç»“æ„
        let testNotesData = {
            currentNoteId: null,
            notes: {}
        };

        // åŸºç¡€æ€§èƒ½æµ‹è¯•
        async function testStartupTime() {
            const startTime = performance.now();
            
            // æ¨¡æ‹Ÿå¯åŠ¨è¿‡ç¨‹
            await new Promise(resolve => setTimeout(resolve, 100)); // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('basicResults').innerHTML += `
                <div>âœ… å¯åŠ¨æ—¶é—´æµ‹è¯•: ${duration.toFixed(2)}ms</div>
            `;
        }

        async function testSaveTime() {
            const testNote = {
                id: 'test_note',
                title: 'æµ‹è¯•ç¬”è®°',
                content: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç¬”è®°çš„å†…å®¹'.repeat(100), // çº¦2KBå†…å®¹
                lastModified: new Date().toISOString(),
                versions: []
            };

            const startTime = performance.now();
            
            // æ¨¡æ‹Ÿä¿å­˜è¿‡ç¨‹
            testNotesData.notes[testNote.id] = testNote;
            await new Promise(resolve => setTimeout(resolve, 50)); // æ¨¡æ‹Ÿå­˜å‚¨å»¶è¿Ÿ
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('basicResults').innerHTML += `
                <div>âœ… ä¿å­˜æ—¶é—´æµ‹è¯•: ${duration.toFixed(2)}ms</div>
            `;
        }

        async function testSwitchTime() {
            const startTime = performance.now();
            
            // æ¨¡æ‹Ÿç¬”è®°åˆ‡æ¢
            await new Promise(resolve => setTimeout(resolve, 30)); // æ¨¡æ‹Ÿåˆ‡æ¢å»¶è¿Ÿ
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('basicResults').innerHTML += `
                <div>âœ… åˆ‡æ¢æ—¶é—´æµ‹è¯•: ${duration.toFixed(2)}ms</div>
            `;
        }

        function testMemoryUsage() {
            if (performance.memory) {
                const memory = performance.memory;
                const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                const totalMB = (memory.totalJSHeapSize / 1024 / 1024).toFixed(2);
                
                document.getElementById('basicResults').innerHTML += `
                    <div>âœ… å†…å­˜å ç”¨: ${usedMB}MB / ${totalMB}MB</div>
                `;
            } else {
                document.getElementById('basicResults').innerHTML += `
                    <div>âš ï¸ æ— æ³•è·å–å†…å­˜ä¿¡æ¯ï¼ˆæµè§ˆå™¨ä¸æ”¯æŒï¼‰</div>
                `;
            }
        }

        // å‹åŠ›æµ‹è¯•
        async function createTestData() {
            const noteCount = 100;
            const progressBar = document.getElementById('progressBar');
            
            for (let i = 0; i < noteCount; i++) {
                const testNote = {
                    id: `test_note_${i}`,
                    title: `æµ‹è¯•ç¬”è®° ${i}`,
                    content: `è¿™æ˜¯ç¬¬ ${i} ä¸ªæµ‹è¯•ç¬”è®°çš„å†…å®¹ã€‚`.repeat(50), // çº¦1KBå†…å®¹
                    lastModified: new Date().toISOString(),
                    versions: []
                };
                
                testNotesData.notes[testNote.id] = testNote;
                
                // æ›´æ–°è¿›åº¦æ¡
                const progress = ((i + 1) / noteCount) * 100;
                progressBar.style.width = progress + '%';
                
                // æ¯10ä¸ªç¬”è®°æš‚åœä¸€ä¸‹ï¼Œé¿å…é˜»å¡UI
                if (i % 10 === 0) {
                    await new Promise(resolve => setTimeout(resolve, 10));
                }
            }
            
            document.getElementById('stressResults').innerHTML += `
                <div>âœ… åˆ›å»ºäº† ${noteCount} ä¸ªæµ‹è¯•ç¬”è®°</div>
            `;
        }

        async function testLargeDataset() {
            const startTime = performance.now();
            
            // æ¨¡æ‹Ÿå¤§æ•°æ®é‡æ“ä½œ
            const noteIds = Object.keys(testNotesData.notes);
            let totalContentLength = 0;
            
            for (const noteId of noteIds) {
                totalContentLength += testNotesData.notes[noteId].content.length;
            }
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('stressResults').innerHTML += `
                <div>âœ… å¤§æ•°æ®é‡æµ‹è¯•: ${duration.toFixed(2)}ms (æ€»å†…å®¹: ${(totalContentLength / 1024).toFixed(2)}KB)</div>
            `;
        }

        async function testStoragePerformance() {
            const startTime = performance.now();
            
            // æ¨¡æ‹Ÿå­˜å‚¨æ“ä½œ
            const dataSize = JSON.stringify(testNotesData).length;
            await new Promise(resolve => setTimeout(resolve, dataSize / 1000)); // æ¨¡æ‹ŸåŸºäºæ•°æ®å¤§å°çš„å»¶è¿Ÿ
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            document.getElementById('stressResults').innerHTML += `
                <div>âœ… å­˜å‚¨æ€§èƒ½æµ‹è¯•: ${duration.toFixed(2)}ms (æ•°æ®å¤§å°: ${(dataSize / 1024).toFixed(2)}KB)</div>
            `;
        }

        function cleanupTestData() {
            testNotesData = {
                currentNoteId: null,
                notes: {}
            };
            
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('cleanupResults').innerHTML = `
                <div>âœ… æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ</div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰æ•°æ®çŠ¶æ€
        window.addEventListener('load', () => {
            document.getElementById('basicResults').innerHTML = `
                <div>ğŸ“Š å½“å‰æµ‹è¯•æ•°æ®çŠ¶æ€: ${Object.keys(testNotesData.notes).length} ä¸ªç¬”è®°</div>
            `;
        });
    </script>
</body>
</html>
